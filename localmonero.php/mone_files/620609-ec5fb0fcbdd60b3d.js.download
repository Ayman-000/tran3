(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[620609],{834269:function(t,e,n){"use strict";n.d(e,{AN:function(){return M},Cp:function(){return g},Di:function(){return s},Dy:function(){return w},F5:function(){return o},Ib:function(){return f},JL:function(){return p},Mg:function(){return i},N7:function(){return S},Nv:function(){return u},Oh:function(){return T},TH:function(){return D},Tg:function(){return I},Uk:function(){return h},Vl:function(){return a},XW:function(){return _},ZB:function(){return B},_4:function(){return P},_U:function(){return R},bG:function(){return N},c0:function(){return b},df:function(){return L},eY:function(){return E},ej:function(){return r},fB:function(){return U},g$:function(){return y},gc:function(){return C},gs:function(){return W},kV:function(){return A},lx:function(){return O},ni:function(){return d},oj:function(){return v},sN:function(){return m},wI:function(){return x},y1:function(){return l},yu:function(){return k},zh:function(){return c}});let r=()=>"/web/calculateFormula",a=()=>"/web/adCreation",i=t=>"/web/adEdit/".concat(t),s=t=>"/web/adDelete/".concat(t),o=t=>"/web/price/".concat(t),u=t=>"/web/".concat(t,"/loadAllDashboardAds"),c=t=>"/web/bulkEditAds".concat(t?"/deleteAds":""),l=()=>"/web/sign_up",f=()=>"/web/log_in",d=()=>"/web/logout",w=t=>"/web/settings_change/".concat(t),h=t=>"/web/email_change/".concat(t),p=t=>"/web/confirmation_letter/".concat(t),g=t=>"/web/password_change/".concat(t),y=t=>"/web/2fa/".concat(t,"/start"),m=t=>"/web/2fa/".concat(t,"/verify"),v=t=>"/web/2fa/".concat(t,"/disable"),T=()=>"/web/reset_request",b=()=>"/web/password_reset",E=t=>"/web/account/".concat(t),O=t=>"/web/note/".concat(t,"/save"),A=t=>"/web/note/".concat(t,"/delete"),S=t=>"/web/affiliate/".concat(t),I=()=>"/web/account/coupon/redeem",_=(t,e)=>"/web/withdrawal/".concat(t,"/").concat(e),C=()=>"/web/tradeRequest",R=t=>"/web/messages".concat(t?"?after=".concat(t):""),x=(t,e)=>"/web/messages/".concat(t).concat(e?"?after=".concat(e):""),N=t=>"/web/message/".concat(t),U=(t,e)=>"/web/tradeAction/".concat(t,"/").concat(e),B=t=>"/web/leaveFeedback/".concat(t),P=t=>"/web/".concat(t,"/generateApiKey"),L=t=>"/web/".concat(t,"/deleteApiKey"),M=()=>"/web/cancelSelected",D=t=>"/web/notification/".concat(t),k=()=>"/web/notifications/read",W=()=>"/web/mostPopularPaymentMethods"},752506:function(t,e,n){"use strict";n.d(e,{M:function(){return s}});var r=n(405121),a=n(903705),i=n(382282);let s=async t=>{let{url:e,data:n}=t;try{await r.Z.postForm(e,n)}catch(t){throw t}};e.Z=(t,e)=>new Promise((n,s)=>{let o=function(){let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(t.headers||(t.headers={}),!e){var c;t.headers["Content-Type"]=null!==(c=t.headers["Content-Type"])&&void 0!==c?c:"application/json",t.headers["X-Requested-With"]="XMLHttpRequest",t.withCredentials=!0}t.method||(t.method="get"),void 0===t.timeout&&(t.timeout=6e4),t.data&&(t.headers["Content-Type"].includes("application/json")&&(t.data=JSON.stringify(t.data)),t.method="post"),(0,r.Z)(t).then(t=>{let{data:e}=t;n(e)}).catch(async n=>{if(n.response)switch(n.response.status){case 400:s(n.response.data);break;case 401:s(401),["/web/logout","/web/log_in"].includes(t.url)||e||await (0,a.kS)();break;case 403:n.response.data&&n.response.data.sanctionType?s(n.response.data):s(403);break;case 429:s(429),e||window.location.reload();break;case 503:if(u<=5){let t=Math.min(250*2**u,3e4);await (0,i._v)(t),await o(u+1)}else s(503);break;default:s(n.response.status)}else n.request?t.url.includes("multiaddr")?s(429):s("NO_RESPONSE"):s("MALFORMED_REQUEST")})};o()})},903705:function(t,e,n){"use strict";n.d(e,{Tz:function(){return o},kS:function(){return c},lK:function(){return u}});var r=n(506410),a=n(834269),i=n(583394),s=n(752506);let o=async()=>{try{await (0,s.Z)({method:"post",url:a.ni(),withCredentials:!0,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}})}catch(t){console.error("Error sending logout request:",t)}},u=async()=>{try{window.sessionStorage.clear(),window.localStorage.clear(),await (0,r.ab)()}catch(t){console.error("Error clearing session/local Storage on logout",t)}},c=async()=>{try{await u(),await o();try{await (0,i.a5)()}catch(t){console.error("Error sending logout message:",t),window.location.assign("/login")}}catch(t){console.error("Logout error:",t),window.location.reload()}}},465829:function(t,e,n){"use strict";n.d(e,{RL:function(){return i},ed:function(){return s},rO:function(){return r},wH:function(){return a}});let r=(t,e)=>{Array.isArray(e)||(e=[e]);let n=t;for(let t=0;t<e.length;t++){if(null==n)return;n=n[e[t]]}return n},a=t=>{let e=[];for(let n of t)e.push(Array.isArray(n)?a(n):n);return e},i=t=>JSON.parse(JSON.stringify(t)),s=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8;return Array.from({length:t},()=>"0123456789abcdef".charAt(Math.floor(16*Math.random()))).join("")}},756421:function(t,e,n){"use strict";n.d(e,{s:function(){return a}});var r=n(367088);let a=t=>{if(null==t?void 0:t.aborted)throw new r.Z("ABORTED")}},243040:function(t,e,n){"use strict";n.d(e,{vt:function(){return a},xv:function(){return r}}),n(322294);let r=async(t,e)=>await navigator.locks.request(t,async t=>await e()),a=async(t,e)=>await navigator.locks.request(t,{ifAvailable:!0},async t=>{if(t)return await e()})},704460:function(t,e,n){"use strict";n.d(e,{J:function(){return a},N:function(){return r}});let r="UTXO_GROUP_",a="SYNC_"},382282:function(t,e,n){"use strict";n.d(e,{Pw:function(){return s},_v:function(){return a},uT:function(){return i}});let r=async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;try{return await t()}catch(n){if(429===n)return await a(5e3),r(t,e+1);throw n}},a=t=>new Promise(e=>setTimeout(e,t)),i=async(t,e)=>Promise.all(t.map(e)).then(e=>t.filter((t,n)=>e[n])),s=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;return Promise.race([...t.map(t=>new Promise(e=>{t.then(e).catch(()=>{})})),new Promise((t,n)=>setTimeout(n,e,Error("Timeout")))])}},439324:function(t,e,n){"use strict";n.d(e,{m:function(){return a},q:function(){return r}});let r=6e5,a=2},963521:function(t,e,n){"use strict";n.d(e,{Uc:function(){return o},uE:function(){return l},xc:function(){return u}});var r=n(402217),a=n(439324),i=n(756082),s=n(668031);let o=async(t,e)=>{try{let n=await (0,i.CZ)((0,s.gG)(t),"PBKDF2");return await r.G.deriveBits({name:"PBKDF2",salt:(0,s.gG)(e.toLowerCase()),iterations:a.q,hash:{name:"SHA-256"}},n,256)}catch(t){throw console.error("Error deriving master key",t),"MASTER_KEY_DERIVATION_ERROR"}},u=async(t,e)=>await (0,i.KE)(t,e),c=async(t,e)=>{try{let n=await (0,i.CZ)(t,"PBKDF2");return await r.G.deriveBits({name:"PBKDF2",salt:(0,s.gG)(e),iterations:1,hash:{name:"SHA-256"}},n,256)}catch(t){console.error("Error while hashing master key",t)}},l=async(t,e)=>{let n=await c(t,e);return(0,s.eL)(n)}},402217:function(t,e,n){"use strict";var r,a,i;n.d(e,{G:function(){return o},e:function(){return s}});let s="undefined"!=typeof self?null==self?void 0:self.crypto:void 0!==(null==window?void 0:window.crypto)?window.crypto:null,o="undefined"!=typeof self?null==self?void 0:null===(r=self.crypto)||void 0===r?void 0:r.subtle:s&&void 0!==(null==window?void 0:null===(a=window.crypto)||void 0===a?void 0:a.subtle)?null==window?void 0:null===(i=window.crypto)||void 0===i?void 0:i.subtle:null},756082:function(t,e,n){"use strict";n.d(e,{CZ:function(){return h},J4:function(){return o},KE:function(){return d},O6:function(){return w},RI:function(){return l},VE:function(){return f},Wu:function(){return g},_0:function(){return c},iW:function(){return p},nj:function(){return u}});var r=n(402217),a=n(668031),i=n(963521),s=n(653619);let o=t=>{try{let e=t.split(".")[0],n=t.split(".")[1],r=n.split("|")[0],a=n.split("|")[1],i=n.split("|")[2];return{encryptionType:e,b64iv:r,b64EncryptedSecretKey:a,b64Mac:i}}catch(t){throw console.error("Error extracting components from encrypted secret",t),"MALFORMED_ENCRYPTED_SECRET_ERROR"}},u=async(t,e)=>{(0,s.K0)(t,"encryptedSecret"),(0,s.RS)(e,32,"masterKey");let n=await (0,i.xc)(e,"mac"),{b64iv:r,b64EncryptedSecretKey:u,b64Mac:l}=o(t),f=(0,a.I2)(r),d=(0,a.I2)(u),w=(0,a.Jm)([f,d]),h=await c(w,n,"SHA-256");return l===(0,a.eL)(h)},c=async function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"SHA-256",a={name:"HMAC",hash:{name:n}},i=await r.G.importKey("raw",e,a,!1,["sign"]);return await r.G.sign(a,i,t)},l=async(t,e,n)=>{let a=await h(e,"AES-CBC",["encrypt"]);return await r.G.encrypt({name:"AES-CBC",iv:n},a,t)},f=async(t,e,n)=>{let a=await h(e,"AES-CBC",["decrypt"]);return await r.G.decrypt({name:"AES-CBC",iv:n},a,t)},d=async function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"SHA-256";try{let i="SHA-256"===r?32:64;if(n>255*i)throw Error("outputByteSize is too large.");let s=new Uint8Array(t);if(s.length<i)throw Error("prk is too small.");let o=(0,a.gG)(e),u=new Uint8Array(o),l=0,f=new Uint8Array(0),d=Math.ceil(n/i),w=new Uint8Array(d*i);for(let e=0;e<d;e++){let a=new Uint8Array(f.length+u.length+1);if(a.set(f),a.set(u,f.length),a.set([e+1],a.length-1),f=new Uint8Array(await c(a.buffer,t,r)),w.set(f,l),(l+=f.length)>=n)break}return w.slice(0,n).buffer}catch(t){console.error("Error during hkdf expand",t)}},w=t=>{try{return r.e.getRandomValues(new Uint8Array(t))}catch(t){console.error("Error while getting random bytes",t)}},h=async function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:["deriveBits"];try{return await r.G.importKey("raw",t,{name:e},!1,n)}catch(t){console.error("Error while importing key",t)}},p=async t=>await r.e.subtle.digest("SHA-256",t),g=async t=>{let e=(0,a.gG)(t);return await p(e)}},668031:function(t,e,n){"use strict";n.d(e,{I2:function(){return s},Jm:function(){return c},Tc:function(){return f},VM:function(){return o},YW:function(){return u},dg:function(){return l},eL:function(){return i},gG:function(){return a},hI:function(){return h},hL:function(){return d},tm:function(){return w}});var r=n(348764).Buffer;let a=t=>{let e=unescape(encodeURIComponent(t)),n=new Uint8Array(e.length);for(let t=0;t<e.length;t++)n[t]=e.charCodeAt(t);return n},i=t=>{let e="",n=new Uint8Array(t);for(let t=0;t<n.byteLength;t++)e+=String.fromCharCode(n[t]);return btoa(e)},s=t=>{let e=atob(t),n=new Uint8Array(e.length);for(let t=0;t<e.length;t++)n[t]=e.charCodeAt(t);return n},o=t=>[...new Uint8Array(t)].map(t=>t.toString(16).padStart(2,"0")).join(""),u=t=>{let e=new Uint8Array(t.length/2);for(let n=0;n<t.length;n+=2)e[n/2]=parseInt(t.substr(n,2),16);return e},c=t=>{try{let e=new Uint8Array(t.reduce((t,e)=>t+e.length,0)),n=0;for(let r of t)e.set(r,n),n+=r.length;return e}catch(e){return console.error("Error while merging Uint8Arrays",e,t),null}},l=t=>r.from(t).toString("hex"),f=t=>r.from(t).toString("base64"),d=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,n=new Uint8Array(e);for(let e=0;e<n.length;e++){let r=255&t;n[e]=r,t=(t-r)/256}return n},w=t=>{let e=0;for(let n=t.length-1;n>=0;n--)e=256*e+t[n];return e},h=t=>ArrayBuffer.isView(t)?r.from(t.buffer,t.byteOffset,t.byteLength):r.from(t)},367088:function(t,e){"use strict";let n={title:"Error",message:"Something went wrong. Refresh the page and try again. Clear cache, cookies, or change browsers. If it keeps happening, reach out to our support.",stringId:"nojs.error.server"},r={GENERIC:n,MAC_VERIFICATION_ERROR:{message:"Wrong password.",title:"Wrong password.",stringId:""},NO_SOLUTION:{message:"Please deposit at least {requiredAmount} more {asset} to your wallet first to fund this trade.",title:"Insufficient balance",stringId:""},TRADE_AMOUNT_TOO_LOW:{title:"Trade amount is too low",message:"This trade's amount is too low to be funded. Please cancel this trade and open a new one for a larger amount.",stringId:""},INVALID_SOLVER_INPUT:n,XPUB_NOT_IN_DESCRIPTOR:{title:"Descriptor does not match account's mnemonic",message:"Descriptor returned by the backend doesn't include xpub derived from account's mnemonic"},TOO_MANY_TRADES:{title:"Too many trades",message:"You have too many selling trades open - cancel or finalize some of them before accepting this one."},OUTPUT_BELOW_DUST_THRESHOLD:{title:"Amount is too low",message:"Transaction amount too low to send",stringId:""},ABORTED:{title:"Cancelled",message:"The process has been aborted."},TX_BUILDING_ERROR:n,VALUE_EXCEEDS_BALANCE:{title:"Withdrawal amount too high",message:"Withdrawal amount too high"},FEE_TOO_LOW:{title:"Withdrawal error",message:"The selected fee was rejected by the network. Please increase the fee or try again later."},PLATFORM_SYNC_ERROR:{title:"Sync error",message:"There has been an error while syncing your wallet. Please log out, clear your cache and cookies, and try again. If that doesn't help, please contact our support."},HEADLESS_WALLET_ERROR:{title:"Wallet error",message:"HEADLESS_WALLET_ERROR"}};e.Z=class extends Error{static isValidErrorCode(t){return!!r[t]}constructor(t="GENERIC",e={}){var n,a,i,s;r.hasOwnProperty(t)||(t="GENERIC");let o=(null===(n=r[t])||void 0===n?void 0:n.title)||"An unknown error occurred";super(o),this.name=this.constructor.name,this.code=t,this.title=null===(a=r[t])||void 0===a?void 0:a.title,this.stringId=null===(i=r[t])||void 0===i?void 0:i.stringId,this.details=e,this.message=null===(s=r[t])||void 0===s?void 0:s.message,"NO_SOLUTION"===t&&((null==e?void 0:e.lackingBalance)&&(null==e?void 0:e.asset)?this.message=this.message.replace("{requiredAmount}",e.lackingBalance).replace("{asset}",e.asset):this.message="Please deposit more ".concat(null==e?void 0:e.asset," into your wallet to fund this trade."))}}},330620:function(t,e,n){"use strict";n.d(e,{H:function(){return i}});var r=n(367088),a=n(489080);let i=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Error";if(t instanceof r.Z||t instanceof a.Z){let{code:n,details:r}=t;console.error(n,"|",e,"\n\n",t,"\n\n",r)}else console.error(e,t)}},489080:function(t,e){"use strict";let n={GENERIC:{message:"Something went wrong on validation"},NULL:{message:"Must not be null!"},INVALID_BYTE_ARRAY:{message:"Must be a properly-sized ArrayBuffer or Uint8Array of non-null bytes."},ASSERTION_FAILED:{message:"Assertion has failed."}};e.Z=class extends Error{constructor(t,e={}){var r;n.hasOwnProperty(t)||(t="GENERIC");let a=(null===(r=n[t])||void 0===r?void 0:r.message)||"A validation error occurred";super(a),this.name=this.constructor.name,this.code=t,this.details=e}}},646615:function(t,e,n){"use strict";n.d(e,{Bi:function(){return c},DE:function(){return A},DF:function(){return l},GG:function(){return O},N$:function(){return R},PQ:function(){return v},Q8:function(){return _},RQ:function(){return m},UY:function(){return i},W3:function(){return y},X:function(){return h},XE:function(){return d},Zb:function(){return x},_V:function(){return b},cJ:function(){return a},cz:function(){return T},gI:function(){return o},hm:function(){return w},id:function(){return C},jE:function(){return s},lZ:function(){return E},nX:function(){return I},tA:function(){return S},tD:function(){return f},uu:function(){return u},vB:function(){return g},w:function(){return p},wA:function(){return U},wS:function(){return r},xL:function(){return N}});let r="bitcoinFormattedWalletTxs",a="bitcoinDecodedWalletTxs",i="bitcoinUtxos",s="bitcoinExternalDescriptorExpression",o="bitcoinInternalDescriptorExpression",u="bitcoinBlockchainTip",c="bitcoinBlockTimestamp",l="bitcoinAddressScriptHashes",f="bitcoinAddressesTxHistories",d="bitcoinGeneratedAddresses",w="bitcoinBip39Seed",h="moneroKeysData",p="moneroCacheData",g="moneroTxsCache",y="moneroFirstSync",m="walletEnc",v="walletMac",T="keysBackupEnc",b="keysBackupMac",E="walletIsInaccessible",O="activeAssets",A="walletCache",S="walletNodes",I="saneWalletNodes",_="userSelectedNode",C="lastOpenedAsset",R="fiatPrices",x="fiatPricesCurrency",N="encryptedSecret",U="accountVersion"},506410:function(t,e,n){"use strict";n.d(e,{FY:function(){return i},GL:function(){return l},Gf:function(){return u},WZ:function(){return h},XA:function(){return c},Xl:function(){return o},aT:function(){return w},ab:function(){return f},ch:function(){return d},ef:function(){return s},sC:function(){return a}});var r=n(424678);let a=async(t,e,n)=>{await (0,r.t8)(t,e,n)},i=async t=>{await (0,r.vw)(t)},s=async(t,e)=>await (0,r.U2)(t,e),o=async t=>await (0,r.yS)(t),u=async(t,e)=>{await (0,r.Vx)(t,e)},c=async(t,e)=>await (0,r.IV)(t,e),l=async t=>{await (0,r.Qv)(t)},f=async()=>{await (0,r.ZH)()},d=t=>(0,r.MT)(t,t+"-store"),w=async t=>await (0,r.qh)(t),h=async t=>await (0,r.XP)(t)},596045:function(t,e,n){"use strict";n.d(e,{bZ:function(){return s},fp:function(){return i},m8:function(){return a}});var r=n(690261);let a=(t,e)=>{if(!(0,r.h)())try{localStorage.setItem(t,e)}catch(n){console.error("Error saving to localStorage",{key:t,value:e},n)}},i=t=>{if(!(0,r.h)())try{return localStorage.getItem(t)}catch(e){return console.error("Error getting from localStorage",{key:t},e),null}},s=t=>{if(!(0,r.h)())try{localStorage.removeItem(t)}catch(e){console.error("Error removing item from localeStorage",{key:t},e)}}},422808:function(t,e,n){"use strict";n.d(e,{AG:function(){return k},BS:function(){return Z},Br:function(){return X},CG:function(){return L},Cy:function(){return K},Dr:function(){return tt},EP:function(){return $},Ev:function(){return _},FQ:function(){return Q},I8:function(){return l},Jb:function(){return x},MS:function(){return d},M_:function(){return w},Mn:function(){return I},N6:function(){return j},ND:function(){return H},RB:function(){return tr},TU:function(){return g},VH:function(){return P},Yu:function(){return F},Zo:function(){return V},Zw:function(){return B},_$:function(){return J},ak:function(){return te},cG:function(){return Y},cH:function(){return m},dj:function(){return T},eO:function(){return N},fH:function(){return q},gG:function(){return tn},hL:function(){return M},if:function(){return U},jI:function(){return W},lr:function(){return ta},nh:function(){return b},oY:function(){return A},qJ:function(){return S},ro:function(){return C},tH:function(){return z},tR:function(){return y},tq:function(){return h},tw:function(){return c},uu:function(){return G},v8:function(){return O},vX:function(){return E},wX:function(){return D},x2:function(){return p},xi:function(){return f},zo:function(){return v},zq:function(){return R}});var r=n(596045),a=n(756082),i=n(506410),s=n(646615),o=n(653619),u=n(668031);let c=async(t,e)=>{let n=+Date.now();delete t.syncing,await (0,i.sC)(s.DE+e,{...t,cachedAt:n})},l=async t=>await (0,i.ef)(s.DE+t)||null,f=t=>{let e=d();t.length>e.length?(0,r.m8)(s.GG,JSON.stringify([...new Set(t)])):(t.length,e.length)},d=()=>{try{let t=JSON.parse((0,r.fp)(s.GG));if(!t)return[];return t}catch(t){return console.error("Error getting active assets",t),[]}},w=t=>{(0,r.m8)(s.id,t)},h=()=>(0,r.fp)(s.id),p=()=>{(0,r.m8)(s.lZ,"true")},g=()=>{try{return"true"===(0,r.fp)(s.lZ)}catch(t){return console.error("Error getting wallet inaccessible state",t),!1}},y=async t=>{(0,o.RS)(t,32);let e=await (0,a.KE)(t,"walletEnc"),n=await (0,a.KE)(t,"walletMac");await (0,i.FY)([[s.RQ,e],[s.PQ,n]])},m=async()=>{let t=await (0,i.Xl)([s.RQ,s.PQ]);return{walletEnc:t[0],walletMac:t[1]}},v=async t=>{(0,o.RS)(t,32);let e=await (0,a.KE)(t,"xmrMultisigKeysBackupEnc"),n=await (0,a.KE)(t,"xmrMultisigKeysBackupMac");await (0,i.FY)([[s.cz,e],[s._V,n]])},T=async()=>{let t=await (0,i.Xl)([s.cz,s._V]);return{keysEnc:t[0],keysMac:t[1]}},b=async(t,e)=>{try{await (0,i.FY)([[s.X,t],[s.w,e]])}catch(t){throw console.error("Error saving XMR wallet data",t),t}},E=async()=>{try{let t=await (0,i.WZ)(),e=t.filter(t=>t.includes(s.w));try{e.some(t=>t.includes("__part"))&&e.sort((t,e)=>{let n=parseInt(t.split("__part")[1],10),r=parseInt(e.split("__part")[1],10);return n-r})}catch(t){console.error("Error sorting cache data parts keys",t)}let n=await (0,i.Xl)([s.X,...e]),r=(0,u.Jm)(n.slice(1));return{keysData:n[0],cacheData:r}}catch(t){return console.error("Error getting XMR wallet data",t),{keysData:null,cacheData:null}}},O=()=>{(0,r.m8)(s.W3,"true")},A=()=>"true"===(0,r.fp)(s.W3),S=()=>{(0,r.bZ)(s.W3)},I=async t=>{await (0,i.Gf)(s.vB,e=>(null!=e||(e=[]),e.push(t),e))},_=async t=>{await (0,i.Gf)(s.vB,e=>(null!=e||(e=[]),t=t.map(t=>t.hash),e.filter(e=>!t.includes(e.hash))))},C=async()=>{var t;return null!==(t=await (0,i.ef)(s.vB))&&void 0!==t?t:[]},R=async t=>{await (0,i.sC)(s.hm,t)},x=async()=>await (0,i.ef)(s.hm),N=async()=>{let t=await (0,i.Xl)([s.jE,s.gI]);return{externalDescriptorExpression:t[0],internalDescriptorExpression:t[1]}},U=async(t,e)=>{await (0,i.FY)([[s.jE,t],[s.gI,e]])},B=async()=>{await (0,i.GL)([s.jE,s.gI])},P=async()=>{try{return await (0,i.ef)(s.wS)||[]}catch(t){return console.error("Error getting formatted wallet txs",t),[]}},L=async t=>{await (0,i.sC)(s.wS,t)},M=async()=>await (0,i.ef)(s.cJ)||[],D=async t=>{await (0,i.sC)(s.cJ,t)},k=async()=>await (0,i.ef)(s.UY)||[],W=async t=>{await (0,i.sC)(s.UY,t)},H=()=>{try{return JSON.parse((0,r.fp)(s.DF))||{}}catch(t){return{}}},Z=(t,e)=>{let n=H();n[t]=e,(0,r.m8)(s.DF,JSON.stringify(n))},F=()=>(0,r.fp)(s.uu),X=t=>(0,r.m8)(s.uu,t),G=async()=>await (0,i.ef)(s.tD)||{},K=async t=>{await (0,i.Gf)(s.tD,e=>(e||(e={}),e={...e,...t}))},V=()=>(0,r.fp)(s.XE),J=t=>(0,r.m8)(s.XE,t),Y=async t=>{await (0,i.Gf)(s.Bi,e=>(e||(e={}),e={...t,...e}))},z=async()=>await (0,i.ef)(s.Bi),j=async(t,e,n)=>{await (0,i.sC)(s.N$+e,t),(0,r.m8)(s.Zb+e,n)},q=async t=>await (0,i.ef)(s.N$+t),Q=t=>(0,r.fp)(s.Zb+t),$=async(t,e)=>{await (0,i.sC)(s.tA+t,e)},tt=async t=>await (0,i.ef)(s.tA+t),te=async t=>await (0,i.ef)(s.nX+t)||[],tn=async(t,e)=>{await (0,i.sC)(s.Q8+t,e)},tr=async t=>await (0,i.ef)(s.Q8+t)||null,ta=async t=>{await (0,i.XA)(s.Q8+t)}},99712:function(t,e,n){"use strict";n.d(e,{i:function(){return a}});var r=n(752506);let a=async(t,e)=>{let{content:n}=await (0,r.Z)({url:"/web/account/".concat(e,"/trades"),params:{buyer:!1,asset:t}});return n.filter(t=>{let{multisig:e,fundedAt:n}=t;return e&&n})}},653619:function(t,e,n){"use strict";n.d(e,{K0:function(){return a},RS:function(){return i},hu:function(){return s}});var r=n(489080);let a=(t,e)=>{if(null==t||""===t)throw new r.Z("NULL",{name:e,value:t})},i=(t,e,n)=>{if(!(()=>{if(!(t instanceof ArrayBuffer||t instanceof Uint8Array)||t.byteLength!==e)return!1;let n=new Uint8Array(t);for(let t=0;t<n.length&&0===n[t];t++);return!0})())throw new r.Z("INVALID_BYTE_ARRAY",{name:n,value:t})},s=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Assertion failed";if(!t)throw new r.Z("ASSERTION_FAILED",{name:e})}},90963:function(t,e,n){"use strict";n.d(e,{A_:function(){return o},Cf:function(){return c},he:function(){return l},jt:function(){return u}});var r=n(756082),a=n(668031),i=n(422808),s=n(750880);let o=async(t,e,n,r,a)=>{if("BTC"===a)return await Promise.all([...Array(e)].map(async(e,a)=>await t.deriveReceive(n+a,r)))},u=t=>{let e=[];return t.forEach(t=>{let{toAddresses:n}=t;e.push(...n)}),e},c=(t,e)=>{let n=t.filter(t=>e.includes(t)),r=n[n.length-1];return t.indexOf(r)},l=async(t,e)=>{let o=(0,i.ND)(),u=o[t];if(!u||e){let o=await n.e(617656).then(n.bind(n,617656)),c=o.address.toOutputScript(t,o.networks[(0,s._V)("BTC")]);if(e)u=c;else{let e=new Uint8Array(await (0,r.iW)(c));u=(0,a.dg)(e.reverse()),(0,i.BS)(t,u)}}return u}},132286:function(t,e,n){"use strict";n.d(e,{HT:function(){return p},JJ:function(){return w},W3:function(){return m},X8:function(){return y},dX:function(){return g},vY:function(){return h}});var r=n(422808),a=n(346194),i=n(813012),s=n(809530),o=n(752506),u=n(99712),c=n(418475),l=n(978303),f=n(750880),d=n(465829);let w=async(t,e)=>{e||(e=await (0,r.AG)());let n=0,i=0;for(let r of e)await (0,a.lT)(r,[],t)?n+=r.value:i+=r.value;return{confirmedBalance:n,unconfirmedBalance:i}},h=(t,e)=>{let n={};return(e&&Object.keys(e).forEach(t=>{let r=t.substring(0,3).toUpperCase();n[r]=new i.Z(e[t]).toFixed(s.X6[r].precision)}),t&&Object.keys(t).forEach(e=>{var r;"number"==typeof(null===(r=t[e])||void 0===r?void 0:r.balanceAvailable)&&(n[e]=(0,f.U8)((0,f.Rx)(t[e].balanceAvailable,e),e))}),Object.keys(n).length)?n:{BTC:new i.Z(0).toFixed(s.X6.BTC.precision),XMR:new i.Z(0).toFixed(s.X6.XMR.precision)}},p=async t=>await (0,o.Z)({url:"/web/account/multisig/".concat(t,"/balance")}),g=async(t,e,n)=>{let r=[];switch(t){case"BTC":let a=await (0,u.i)(t,e);r=a.map(c.rO);break;case"XMR":let s=await (0,l.uz)(t,e),o=await n.getUtxos(),d=t=>{let{id:e}=t;return o.find(t=>t.keyImage.hex===e).amount};s.forEach(t=>{let{assignedTrades:[{id:e}],assignedUtxos:n}=t,a=n.map(d).reduce((t,e)=>new i.Z(t).plus(e),0);r.push({id:e,value:a})})}r=r.map(e=>{let{id:n,value:r}=e;return{id:n,value:(0,f.Rx)(r,t)}});let w=(0,f.d4)(r,"value");return{tradeReservations:r,totalReservedBalance:w}},y=(t,e,n,a)=>{let i=!0;try{let e=(0,r.MS)();for(let n of((null==e?void 0:e.length)||(i=!1),e))if("number"!=typeof t[n].balanceAvailable){i=!1;break}}catch(t){i=!1}a(h(i?t:m(e),n))},m=t=>{try{let e=(0,d.RL)(t);for(let t in e){let n=e[t];Object.keys(n).forEach(n=>{e[t][n]=(0,f.NF)(e[t][n],t)})}return e}catch(t){return null}}},197988:function(t,e,n){"use strict";n.d(e,{oI:function(){return O},createMultisigBitcoinWallet:function(){return I},deriveAccountLevelKeyBase58String:function(){return E},ho:function(){return S},getAccountBitcoinDescriptors:function(){return _},G9:function(){return b},getBip39SeedFromSecretKey:function(){return v},Es:function(){return A}});var r=n(750880),a=n(133526),i=n(437786),s=n(703379),o=n.n(s),u=n(45217),c=n(677235),l=n(422808),f=n(752506),d=n(193396),w=n(90963),h=n(367088);let p=async()=>{let t=await n.e(617656).then(n.bind(n,617656));return t.networks[(0,r._V)("BTC")]};n(202153);let g=(0,i.BIP32Factory)(c),y=(0,u.default)(c),m=(0,r._V)("BTC"),v=async t=>{let e=await (0,a.wg)(t,"BTC");return await (0,a.sp)(e)},T=async t=>E(t,"public"),b=async t=>g.fromSeed(t,await p(m)),E=async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"public",n=await b(t),a=n.deriveHardened(87).deriveHardened(r.jj[(0,r._V)("BTC")]).deriveHardened(0);switch(e){case"public":return a.neutered().toBase58();case"private":return a.toBase58()}},O=async(t,e,a,i,s)=>{let u=await n.e(617656).then(n.bind(n,617656)),l=await Promise.all([n.e(662257),n.e(617656),n.e(493540)]).then(n.t.bind(n,92791,23)),{Descriptor:f}=l.DescriptorsFactory(c),d=async t=>{let e={address:t.address,value:t.value};if(!e.address||t.isChange){let t;if(e.address)({addressIndex:t}=i.getDerivationPathIndicesOfAddress(e.address));else if(s)e.address=s,{addressIndex:t}=i.getDerivationPathIndicesOfAddress(e.address);else{let n=await i.createReceiveChange();e.address=n.address,t=n.addressIndex,i.internalWalletChainLastUsedAddressIndex=n.addressIndex+1}let n=new f({expression:i.getChainDescriptorExpression(1),index:t,network:await p(m)}),r=n.expand(),a=r.expansionMap["@0"],o=r.expansionMap["@1"];e.bip32Derivation=[{masterFingerprint:o.masterFingerprint,path:o.path,pubkey:o.pubkey},{masterFingerprint:a.masterFingerprint,path:a.path,pubkey:a.pubkey}],e.witnessScript=n.getWitnessScript()}return e.script=await (0,w.he)(e.address,!0),e};e=await Promise.all(e.map(t=>d(t)));let h=o().sortInputs(t),g=o().sortOutputs(e),v=new u.Psbt({network:await p(m)}),T=[],b=[];for(let t of h){let e=h.indexOf(t),{addressIndex:n,chainIndex:s}=i.getDerivationPathIndicesOfAddress(t.address);if(null===n||null===s||n<0||s<0)throw"INVALID_INPUT_ADDRESS";let o=new f({expression:i.getChainDescriptorExpression(s),index:n,network:u.networks[(0,r._V)("BTC")]}),{vout:c,txId:l,value:d,txHex:w}=t,p=a[s].derive(n);b[e]=p.privateKey;let g=o.expand(),y=g.expansionMap["@0"],m=g.expansionMap["@1"];T[e]=m.pubkey;let E=o.getScriptPubKey(),O=o.getWitnessScript(),A=u.Transaction.fromHex(w).toBuffer(),S={hash:l,index:c,witnessUtxo:{value:d,script:E},nonWitnessUtxo:A,witnessScript:O,bip32Derivation:[{masterFingerprint:m.masterFingerprint,path:m.path,pubkey:m.pubkey},{masterFingerprint:y.masterFingerprint,path:y.path,pubkey:y.pubkey}]};v.addInput(S)}g.forEach(t=>{v.addOutput(t)});let E=t=>{let e=y.fromPrivateKey(b[t],{network:u.networks[(0,r._V)("BTC")]});v.signInput(t,e)};h.forEach((t,e)=>{E(e)});let O=v.__CACHE.__TX;return{psbt:v,tx:O}},A=async t=>{let e=await n.e(617656).then(n.bind(n,617656)),r=e.Psbt.fromBase64(t);return r.extractTransaction().toHex()},S=async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=await Promise.all([n.e(662257),n.e(617656),n.e(493540)]).then(n.t.bind(n,92791,23)),{Descriptor:a}=r.DescriptorsFactory(c),i=new a({expression:t,index:e,network:await p(m)});return i.getAddress()},I=async t=>{let e=0,n=async()=>{let i=await (0,a.sp)(t);try{let{externalDescriptorExpression:t,internalDescriptorExpression:e}=await (0,l.eO)();if(!t||!e){let n=await T(i),a=d.Jd[(0,r._V)("BTC")],{externalDescriptor:s,internalDescriptor:o}=await (0,f.Z)({url:"/web/account/multisig/BTC/initialize",data:{xpub:n,accountDerivationPath:a}});t=s,e=o,await (0,l.if)(t,e)}let n=await S(t),a=await S(e);await (0,f.Z)({url:"/web/account/multisig/BTC/finalize",data:{externalAddress:n,internalAddress:a}})}catch(a){if(console.error("Error creating BTC multisig wallet",a),e<2)e++,await (0,l.Zw)(),await (0,r.G0)("BTC"),await n(t);else throw a}};await n()},_=async t=>{let{externalDescriptor:e,internalDescriptor:n}=await (0,f.Z)({url:"/web/account/multisig/BTC/restore"}),r=await E(t);if(!e.includes(r))throw new h.Z("XPUB_NOT_IN_DESCRIPTOR",{xpub:r,externalDescriptor:e});return{externalDescriptor:e,internalDescriptor:n}}},193396:function(t,e,n){"use strict";n.d(e,{$I:function(){return f},AM:function(){return u},I0:function(){return c},If:function(){return p},Jd:function(){return i},Mc:function(){return a},Rb:function(){return o},YS:function(){return d},ak:function(){return l},hh:function(){return s},rA:function(){return w},rh:function(){return h},zh:function(){return r}});let r=20,a=330,i={bitcoin:"m/87'/0'/0'",testnet:"m/87'/1'/0'"},s=2,o=1e9,u=1e7,c=16,l=5,f=1e4,d=.05,w={BTC:1,XMR:10},h=1e4,p=2896770},522719:function(t,e,n){"use strict";n.d(e,{K:function(){return d},p:function(){return f}});var r=n(243040),a=n(596045),i=n(752506),s=n(704460),o=n(382282),u=n(756421),c=n(367088);let l=async(t,e,n,r,s)=>{let o=(0,a.fp)("previousPlatformSyncRequestedAt"+t);if(n||!o||Date.now()-o>=2e4){try{let n={url:"/web/account/multisig/".concat(t,"/sync"),method:"post"};"XMR"===t&&(await e.sync(),n.data={multisigHex:await e.exportMultisigHex()}),s&&Object.keys(s).length&&(n.signal=s);let r=await (0,i.Z)(n);if("XMR"===t)return await e.importMultisigHex(r.multisigHex),r.multisigHex}catch(t){if(r)throw t}(0,a.m8)("previousPlatformSyncRequestedAt"+t,Date.now())}},f=async(t,e,n)=>{await (0,r.vt)(s.J+t,async()=>{await (0,r.vt)(s.N+t,async()=>{await l(t,e,n)})})},d=async(t,e,n)=>{await (0,r.vt)(s.J+t,async()=>{let r=async()=>{try{(0,u.s)(n),await l(t,e,!0,!0,n)}catch(e){if(console.error(t,"Sync error:",e),null==n?void 0:n.aborted)return;if((null==e?void 0:e.message)==="339")throw console.error("retryPlatformSyncUntilSucceeds stale keys 339"),new c.Z("PLATFORM_SYNC_ERROR");if(await (0,o._v)(1e3),["291","317"].includes(null==e?void 0:e.message))return await r()}};try{return await r()}catch(e){throw console.error(t,"Error while acquiring lock or syncing:",e),e}})}},97723:function(t,e,n){"use strict";var r=n(667294);let a=(0,r.createContext)({XMR:{txs:[]},BTC:{txs:[]}});e.Z=a},583394:function(t,e,n){"use strict";n.d(e,{D1:function(){return o},F:function(){return d},JQ:function(){return u},N7:function(){return l},Xg:function(){return c},a5:function(){return f},hv:function(){return h},mP:function(){return p},ot:function(){return w},s4:function(){return i}});var r=n(836469),a=n(690261);let i=(t,e)=>setInterval(async function(){try{await t.postMessage("IS_CHANNEL_OPEN")}catch(n){t=new r.g0(e,{webWorkerSupport:!1})}},1e3),s=null;(0,a.h)()||i(s=new r.g0("wallet",{webWorkerSupport:!1}),"wallet");let o=async t=>{s.isClosed||await s.postMessage({type:"BALANCE",asset:t})},u=async t=>{s.isClosed||await s.postMessage({type:"REFRESH",asset:t})},c=async(t,e)=>{s.isClosed||await s.postMessage({type:"MANUAL_SYNC",asset:e,value:t})},l=async(t,e)=>{s.isClosed||await (null==s?void 0:s.postMessage({type:"TX",asset:t,value:e}))},f=async()=>{s.isClosed||await (null==s?void 0:s.postMessage({type:"LOGOUT"}))},d=async()=>{s.isClosed||await (null==s?void 0:s.postMessage({type:"LOGIN"}))},w=async t=>{s.isClosed||await (null==s?void 0:s.postMessage({type:"WALLET_CREATED",asset:t}))},h=async t=>{s.isClosed||await (null==s?void 0:s.postMessage({type:"FIAT_PRICES_UPDATED",asset:t}))},p=()=>{if(!(0,a.h)())return s}},529467:function(t,e,n){"use strict";n.d(e,{a:function(){return s},r:function(){return i}});var r=n(422808),a=n(197988);class i{static async initialize(){let{externalDescriptorExpression:t,internalDescriptorExpression:e}=await (0,r.eO)();if(!t||!e)throw"NO_WALLET_DATA";return new i(t,e)}async deriveReceive(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=await (0,a.ho)(this.walletChainDescriptorExpressions[e],t);return this.generatedAddresses[e][t]=n,this.saveWalletChainAddresses(),n}async createReceive(){return await this.deriveReceive(this.externalWalletChainLastUsedAddressIndex)}async createReceiveChange(){let t=this.internalWalletChainLastUsedAddressIndex,e=await this.deriveReceive(t,1);return{address:e,addressIndex:t}}getDerivationPathIndicesOfAddress(t){return i._getDerivationPathIndicesOfAddress(t)}static _getDerivationPathIndicesOfAddress(t){let e=i.retrieveWalletChainAddresses(),n=null,r=null;return e.forEach((e,a)=>{e.includes(t)&&(n=e.indexOf(t),r=a)}),{addressIndex:n,chainIndex:r}}getChainDescriptorExpression(t){return this.walletChainDescriptorExpressions[t]}set externalWalletChainLastUsedAddressIndex(t){this.walletChainLastUsedAddressIndices[0]=t,this.saveWalletChainIndices()}get externalWalletChainLastUsedAddressIndex(){return this.walletChainLastUsedAddressIndices[0]}set internalWalletChainLastUsedAddressIndex(t){this.walletChainLastUsedAddressIndices[1]=t,this.saveWalletChainIndices()}get internalWalletChainLastUsedAddressIndex(){return this.walletChainLastUsedAddressIndices[1]}saveWalletChainIndices(){localStorage.setItem("walletChainLastUsedAddressIndices",JSON.stringify(this.walletChainLastUsedAddressIndices))}static retrieveWalletChainIndices(){try{let t=localStorage.getItem("walletChainLastUsedAddressIndices");if(t)return JSON.parse(t);return null}catch(t){return null}}saveWalletChainAddresses(){(0,r._$)(JSON.stringify(this.generatedAddresses))}static retrieveWalletChainAddresses(){try{let t=(0,r.Zo)();if(t)return JSON.parse(t);return null}catch(t){return null}}constructor(t,e){var n,r;this.walletChainDescriptorExpressions=[t,e],this.walletChainLastUsedAddressIndices=null!==(n=i.retrieveWalletChainIndices())&&void 0!==n?n:[0,0],this.generatedAddresses=null!==(r=i.retrieveWalletChainAddresses())&&void 0!==r?r:[[],[]]}}let s=t=>{try{let{addressIndex:e}=i._getDerivationPathIndicesOfAddress(t);return null!==e}catch(e){return console.error("Error determining ownership of an address",{address:t,e}),!1}}},133526:function(t,e,n){"use strict";n.d(e,{GO:function(){return u},sp:function(){return s},wg:function(){return o}});var r=n(653619),a=n(668031);let i=n(202153),s=async t=>await i.mnemonicToSeed(t),o=async t=>{try{let e=await f(t),n=l(e);return n}catch(t){console.error("Error while making mnemonic seed",t)}},u=async t=>{(0,r.K0)(t),(0,r.hu)(i.validateMnemonic(t),"getSecretKeyBytesFromMnemonic");let e=c(t);return await (0,a.YW)(e)},c=t=>i.mnemonicToEntropy(t),l=t=>{try{return i.entropyToMnemonic(t)}catch(t){console.error("Error while making Bitcoin mnemonic seed from entropy hex string",t)}},f=async t=>(0,a.VM)(t)},6884:function(t,e,n){"use strict";n.d(e,{Hk:function(){return D},CV:function(){return H},Zx:function(){return M},_l:function(){return k},Xo:function(){return P},vM:function(){return W},zZ:function(){return Z},zc:function(){return L}});var r=n(752506);let a=async()=>{let{fastestFee:t,halfHourFee:e,hourFee:n,economyFee:a,minimumFee:i}=await (0,r.Z)({url:"".concat("https://mempool.space/api","/v1/fees/recommended")},!0);return{HIGH:t,MEDIUM:e,LOW:n,NO_PRIORITY:a}};var i=n(750880);let s=t=>{if(t<75)return 1;if(t<=255)return 2;if(t<=65535)return 3;if(t<=4294967295)return 5;throw"Size of redeem script is too large"},o=t=>{if(t<253)return 1;if(t<65535)return 3;if(t<4294967295)return 5;if(t<18446744073709552e3)return 9;throw"Invalid var int"},u=(t,e,n)=>{let r;return r="P2PKH"===t||"P2SH"===t?0:.5+e/4,4+o(e)+o(n)+4+r},c=t=>{let e,{address:n}=t,r=n?(0,i.eb)(n):"P2WSH",a=0,u=0;switch(r){case"P2PKH":a=148;break;case"P2SH-P2WPKH":a=90.75,u=107;break;case"P2WPKH":a=67.75,u=107;break;case"P2TR":a=57.25,u=65;break;case"P2SH":e=71;let c=147+s(e)+e;a=36+o(c)+c+4;break;case"P2SH-P2WSH":case"P2WSH":a=36+(u=147+s(e=71)+e)/4+4,"P2SH-P2WSH"===r&&(a+=35)}return a},l=t=>{let{address:e}=t,n=e?(0,i.eb)(e):"P2WSH";switch(n){case"P2PKH":return 34;case"P2SH":case"P2SH-P2WPKH":case"P2SH-P2WSH":return 32;case"P2WPKH":return 31;case"P2WSH":case"P2TR":return 43}};var f=n(193396);let d=t=>c(t),w=t=>l(t),h=(t,e)=>f.Mc,p=(t,e)=>u("P2WSH",t.length,e.length)+t.reduce((t,e)=>t+d(e),0)+e.reduce((t,e)=>t+w(e),0),g=t=>"number"!=typeof t||!isFinite(t)||t<0?NaN:t,y=t=>t.reduce((t,e)=>t+g(e.value),0),m=w({});var v={dustThreshold:h,finalize:(t,e,n)=>{let r=Math.ceil(p(t,e)),a=n*(r+m),i=y(t)-(y(e)+a);i>=h({},n)&&(e=e.concat({value:i}),r=Math.ceil(r+w({})));let s=y(t)-y(e);return isFinite(s)?{inputs:t,outputs:e,fee:s,txSizeVb:r}:{fee:n*r}},inputBytes:d,outputBytes:w,sumOrNaN:y,sumForgiving:t=>t.reduce((t,e)=>t+(isFinite(e.value)?e.value:0),0),transactionBytes:p,uintOrNaN:g};function T(t,e){return t.value-e*v.inputBytes(t)}var b=(t,e,n)=>{t=t.concat().sort((t,e)=>T(e,n)-T(t,n));let r=function(t,e,n){if(!isFinite(v.uintOrNaN(n)))return{};let r=v.transactionBytes([],e),a=0,i=[],s=v.sumOrNaN(e),o=v.dustThreshold({},n);for(let u=0;u<t.length;++u){let c=t[u],l=v.inputBytes(c),f=n*(r+l),d=v.uintOrNaN(c.value);if(!(a+d>s+f+o)&&(r+=l,a+=d,i.push(c),!(a<s+f)))return v.finalize(i,e,n)}return{fee:n*r}}(t,e,n);return r.inputs?r:function(t,e,n){if(!isFinite(v.uintOrNaN(n)))return{};let r=v.transactionBytes([],e),a=0,i=[],s=v.sumOrNaN(e);for(let o=0;o<t.length;++o){let u=t[o],c=v.inputBytes(u),l=n*c,f=v.uintOrNaN(u.value);if(l>u.value){if(o===t.length-1)return{fee:n*(r+c)};continue}r+=c,a+=f,i.push(u);let d=n*r;if(!(a<s+d))return v.finalize(i,e,n)}return{fee:n*r}}(t,e,n)};function E(t,e,n){if(!isFinite(v.uintOrNaN(n)))return{};let r=v.transactionBytes(t,e),a=n*r;if(0===e.length)return{fee:a};let i=v.sumOrNaN(t),s=v.sumForgiving(e),o=i-s-a;if(!isFinite(o)||o<0)return{fee:a};let u=e.reduce(function(t,e){return t+!isFinite(e.value)},0);if(0===o&&0===u)return v.finalize(t,e,n);let c=e.reduce(function(t,e){return void 0!==e.value?t:t+1},0),l=Math.floor(o/c);return e.every(t=>void 0!==t.value||l>=v.dustThreshold(t,n))?(e=e.map(t=>{if(void 0!==t.value)return t;let e={};for(let n in t)e[n]=t[n];return e.value=l,e}),v.finalize(t,e,n)):{fee:a}}let O=async()=>{let{estimates:t}=await (0,r.Z)({url:"".concat("https://bitcoiner.live/api","/fees/estimates/latest")},!0);return{HIGH:t["30"].sat_per_vbyte,MEDIUM:t["60"].sat_per_vbyte,LOW:t["120"].sat_per_vbyte,NO_PRIORITY:t["1440"].sat_per_vbyte}},A=async t=>{let{primaryRequest:e,secondaryRequest:n,label:r,errorCode:a}=t;try{return await e()}catch(t){console.error("Error ".concat(r),t);try{return await n()}catch(t){throw console.error("Error ".concat(r),t),null!=a?a:S(t)}}},S=t=>t.includes('"code":-26')?"FEE_TOO_LOW":"3BPB_ERR";var I=n(422808),_=n(813012),C=n(346194),R=n(978303),x=n(418475),N=n(465829),U=n(367088),B=n(348764).Buffer;let P=async()=>await A({primaryRequest:a,secondaryRequest:O,label:"getting fee rates"}),L=(t,e,n,r,a,s)=>{let o;if(!e.length)throw"NO_DESTINATION";let u=b;("split"===s||e.some(t=>{let{value:e}=t;return!e}))&&(u=E);let c="number"==typeof r,{inputs:l,outputs:d,fee:w,txSizeVb:h}=u(t,e,c?0:n);if(!l||!d){if(w-e[0].value<f.Mc)throw"OUTPUT_BELOW_DUST_THRESHOLD";throw"NO_COINSELECT_SOLUTION"}if("number"==typeof a){let t=(0,i.d4)(l,"value"),e=(0,i.d4)(d,"value");if(!new _.Z(t).eq(e)){let n=new _.Z(t).minus(e);d[a].value=n.plus(d[a].value).toNumber()}}if(c){o=new _.Z(h).times(n);let t=new _.Z(d[r].value).minus(o);if(t.lt(f.Mc))throw"OUTPUT_BELOW_DUST_THRESHOLD";d[r].value=t.toNumber()}return{inputs:l,outputs:d,fee:o?o.toNumber():w,txSizeVb:h}},M=async t=>{let e=await n.e(617656).then(n.bind(n,617656)),r=e.Transaction.fromHex(t);return{txId:r.getId(),ins:r.ins.map(t=>({txId:B.from(t.hash).reverse().toString("hex"),vout:t.index})),outs:r.outs.map((t,n)=>{let r=null;try{r=e.address.fromOutputScript(t.script,e.networks[(0,i._V)("BTC")])}catch(t){}return{value:t.value,vout:n,address:r,witnessUtxo:t}})}},D=t=>{let e=(0,I.Yu)(),n=t>0?e-(t-1):0,r=n>=f.rA.BTC;return{confirmations:n,isConfirmed:r}},k=(t,e)=>{try{return e.find(e=>e.txId===t)}catch(t){return console.error("Error finding tx by id",t),null}},W=async t=>{let e=await n.e(617656).then(n.bind(n,617656));return t.outs.map((n,r)=>{let a=null;try{a=e.address.fromOutputScript(n.script,e.networks[(0,i._V)("BTC")])}catch(t){}return{txId:t.getId(),value:n.value,vout:r,address:a,witnessUtxo:n,txHex:t.toHex()}})},H=async t=>{let{utxoGroups:e,utxos:n,trades:r,amount:a,address:s,wallet:o,asset:u="BTC"}=t,c=[],l=[{address:s,value:a}];n=(0,N.wH)(n);let f=(0,N.RL)(e),d=(0,R.a1)(f),w={chosenUtxos:c,targets:l};if(!d.length)return c.push(...n),w;let h=n.filter(t=>!d.includes((0,C.Wp)(t)));c.push(...h);let p=new _.Z((0,i.d4)(h,"value"));if(p.gte(a))return w;let g=new _.Z(a).minus(p);f.forEach(t=>{let e=n.filter(e=>t.assignedUtxos.map(t=>{let{id:e}=t;return e}).includes((0,C.Wp)(e))),a=r.filter(e=>t.assignedTrades.map(t=>{let{id:e}=t;return e}).includes(e.id)).map(x.rO);t.groupUtxos=e,t.groupTrades=a,t.utxosSum=(0,i.d4)(e,"value"),t.tradesSum=(0,i.d4)(a,"value")}),f=(0,i.IK)(f,"utxosSum","asc");let y=[];for(;g.gt(0);){if(0===f.length)throw new U.Z("VALUE_EXCEEDS_BALANCE");for(let t=0;t<f.length;t++){let{utxosSum:e,tradesSum:n,groupUtxos:r,assignedTrades:a}=f[t],i=e-n,s=()=>{g=g.minus(i),c.push(...r),y.push(...a),f.splice(t,1)};if(t!==f.length-1){if(g.lte(i)){s();break}}else s()}}if(y.length){r.forEach(t=>{delete t.parentUtxoAddress});let t=r.filter(t=>{let{id:e}=t;return y.map(t=>{let{id:e}=t;return e}).includes(e)});y=t.map(t=>(0,x.rO)(t));let e=o.internalWalletChainLastUsedAddressIndex;for(let t=0;t<y.length;t++){let{value:n,id:a}=y[t],i=await o.deriveReceive(e+1+t,1),s=r.find(t=>t.id===a);s.parentUtxoAddress=i,l.push({isChange:!0,address:i,value:n})}}return w},Z=t=>t.some(t=>{let{type:e,confirmations:n}=t;return"SEND"===e&&0===n})},750880:function(t,e,n){"use strict";n.d(e,{G0:function(){return m},IK:function(){return v},NF:function(){return u},Rx:function(){return c},U8:function(){return l},_V:function(){return s},d4:function(){return y},eb:function(){return g},jj:function(){return o},vK:function(){return p}});var r=n(813012),a=n(752506),i=n(465829);let s=t=>{switch(t){case"BTC":return"bitcoin";case"XMR":return"mainnet"}},o={bitcoin:0,testnet:1},u=(t,e)=>{switch(e){case"BTC":return d(t);case"XMR":return h(t)}},c=(t,e)=>{try{switch(e){case"BTC":return f(t);case"XMR":return w(t)}}catch(t){return console.error("Error formatting amount to full coins",t),0}},l=(t,e)=>{let n=8;return"XMR"===e&&(n=12),new r.Z(t).toFixed(n)},f=t=>(r.Z.DP=8,new r.Z(t).div(1e8).toString()),d=t=>new r.Z(t).times(1e8).toNumber(),w=t=>(r.Z.DP=12,new r.Z(t).div(1e12).toString()),h=t=>new r.Z(t).times(1e12).toNumber(),p={txs:[],balance:0,unconfirmedBalance:0,receiveAddress:"",syncing:!0},g=t=>t.startsWith("1")||t.startsWith("m")||t.startsWith("n")?"P2PKH":t.startsWith("3")||t.startsWith("2")?"P2SH-P2WPKH":t.startsWith("bc1q")||t.startsWith("tb1q")?42===t.length?"P2WPKH":"P2WSH":t.startsWith("bc1p")||t.startsWith("tb1p")?"P2TR":"P2WSH",y=(t,e)=>t.reduce((t,n)=>new r.Z(t).plus((0,i.rO)(n,e)).toNumber(),0),m=async t=>{try{await (0,a.Z)({url:"/web/account/multisig/".concat(t,"/reset"),method:"post"})}catch(t){console.error("Error resetting multisig",t)}},v=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"desc";return t.sort((t,r)=>("desc"===n?1:-1)*((0,i.rO)(r,e)-(0,i.rO)(t,e)))}},346194:function(t,e,n){"use strict";n.d(e,{Wp:function(){return c},ZB:function(){return u},lT:function(){return s},nJ:function(){return o}});var r=n(6884),a=n(422808),i=n(529467);let s=async(t,e,n)=>{let{height:a,address:i}=t;if(!i)throw"NO_UTXO_ADDRESS";let{isConfirmed:s}=(0,r.Hk)(a),o=e.includes(c(t));return!o&&(s||1===n.getDerivationPathIndicesOfAddress(i).chainIndex)},o=async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{unreserved:n}=e,r=await u(),a=[],i=[];for(let e of r){let n=r.indexOf(e);await s(e,a,t)&&i.push(r[n])}return i},u=async()=>{let t=await (0,a.hL)(),e=[];t.forEach(t=>{let{outs:n,height:r,txId:a,txHex:s}=t;n.forEach(t=>{(0,i.a)(t.address)&&e.push({...t,height:r,txId:a,txHex:s})})});let n=[];t.forEach(t=>{let{ins:e}=t;n.push(...e)});let r=e.filter(t=>{let{txId:e,vout:r}=t;return!n.some(t=>t.txId===e&&t.vout===r)});return await (0,a.jI)(r),r},c=t=>{let{txId:e,vout:n}=t;return"".concat(e,":").concat(n)}},734049:function(t,e,n){"use strict";n.d(e,{T:function(){return i},U:function(){return a}});var r=n(346194);let a=async(t,e)=>{switch(t){case"BTC":return await (0,r.nJ)(e,{});case"XMR":return await e.getSpendableUtxos()}},i=async(t,e)=>{switch(t){case"BTC":return await (0,r.nJ)(e);case"XMR":return await e.getUtxos()}}},978303:function(t,e,n){"use strict";n.d(e,{a1:function(){return i},nu:function(){return a},uz:function(){return s}});var r=n(752506);let a=async t=>{try{let e=await s(t);return i(e)}catch(e){return console.error("Error getting ".concat(t," reserved utxos"),e),[]}},i=t=>{let e=[];return t.forEach(t=>{let{assignedUtxos:n}=t;n.forEach(t=>{let{id:n}=t;e.push(n)})}),e},s=async t=>await (0,r.Z)({url:"/web/account/multisig/".concat(t,"/utxoGroups")})},418475:function(t,e,n){"use strict";n.d(e,{K1:function(){return N},ML:function(){return H},Zj:function(){return W},e_:function(){return T},op:function(){return U},rO:function(){return b}});var r=n(243040),a=n(704460),i=n(99712),s=n(750880),o=n(813012),u=n(193396),c=n(6884),l=n(197988),f=n(422808),d=n(668031),w=n(734049),h=n(522719),p=n(367088),g=n(330620),y=n(346194),m=n(465829),v=n(756421);let T=async t=>{let{asset:e,trade:n,username:y,wallet:T,utxos:O,abortSignal:A={},progressCallback:S=()=>{},forceSync:C}=t;return await (0,r.xv)(a.N+e,async()=>{if(S("SYNC"),n){let t=(0,s.NF)(n.amountAsset,"XMR");switch(e){case"BTC":if(new o.Z(t).lte(u.Mc))throw new p.Z("TRADE_AMOUNT_TOO_LOW");break;case"XMR":if(new o.Z(t).lte(u.Rb))throw new p.Z("TRADE_AMOUNT_TOO_LOW")}}if((0,v.s)(A),C)try{await (0,h.K)(e,T,A)}catch(t){}S("SOLUTION"),(0,v.s)(A),"XMR"===e&&await T.thawFrozenOutputs();let t=await (0,i.i)(e,y);if(null!=O||(O=await (0,w.T)(e,T)),!O.length)throw new p.Z("NO_SOLUTION",{asset:e});n&&t.push(n);let r=(0,m.wH)(O);(0,s.IK)(r,["amount"],"asc"),(0,s.IK)(t,"amountAsset","asc");let a=[],x=r.map(t=>E(e,t)),P=t.map(b),L=(0,s.d4)(x,"value"),M=(0,s.d4)(P,"value");if((0,v.s)(A),new o.Z(L).lt(M))throw new p.Z("NO_SOLUTION",{asset:e,lackingBalance:(0,s.Rx)(new o.Z(M).minus(L),e)});(0,v.s)(A);let k=!0;try{switch(e){case"BTC":R(e,P,x,a);break;case"XMR":await _(e,P,x,a,A)}}catch(t){k=!1}if(!k){x=O.map(t=>E(e,t)),a=[];let t=!1;try{(0,v.s)(A),await I(e,P,x,a,A)}catch(n){if("SOLVER_TIMEOUT"===n)t=!0;else throw(0,g.H)(n,"Error while using the solver for ".concat(e," utxo assignment")),n}finally{}t&&(x=O.map(t=>E(e,t)),a=[],(0,v.s)(A),D(x,P,a,e))}if(!a.length)throw new p.Z("NO_SOLUTION",{asset:e});S("TX");let W={};if("BTC"===e){let t=async()=>{(0,v.s)(A);let t=await (0,f.Jb)(),e=await (0,l.G9)((0,d.hI)(t)),n=u.Jd[(0,s._V)("BTC")];return[e.derivePath(n+"/0"),e.derivePath(n+"/1")]};(0,v.s)(A);let[e,n]=await Promise.all([(0,c.Xo)(),t()]);W.feeRates=e,"testnet"===(0,s._V)("BTC")&&(W.feeRates={HIGH:4,MEDIUM:3,LOW:2,NO_PRIORITY:1}),W.chainNodes=n,W.utxoGroupsChangeAddresses=await N(a,T,A)}let H=async(n,r)=>{(0,v.s)(A);let{assignedUtxos:a,assignedTrades:i}=n;try{switch(e){case"BTC":let{feeRates:a,chainNodes:s}=W;await U(O,t,n,T,s,a,r);break;case"XMR":let[{id:o}]=i,u=t.find(t=>t.id===o);await B(O,u,n,T)}}catch(t){throw(0,g.H)(t,"Error creating ".concat(e," tx for utxoGroup")),t instanceof p.Z||(t=new p.Z("TX_BUILDING_ERROR",{e:t})),t}};switch((0,v.s)(A),e){case"BTC":await Promise.all(a.map((t,e)=>H(t,W.utxoGroupsChangeAddresses[e])));break;case"XMR":for(let t of a)await H(t)}return a})},b=t=>{let{amountAsset:e,feeAsset:n,id:r,ad:{asset:a,type:i}}=t;return{value:(0,s.NF)(new o.Z(e).plus(i.includes("BUY")?0:n),a),id:r}},E=(t,e)=>{switch(t){case"BTC":return O(e);case"XMR":return A(e)}},O=t=>{let{value:e,...n}=t;return{value:e,id:(0,y.Wp)(n)}},A=t=>{let{amount:e,keyImage:{hex:n}}=t;return{value:new o.Z(e).toNumber(),id:n}},S=(t,e,n)=>{if(!e.size)throw new p.Z("NO_SOLUTION",{asset:t});for(let[r,a]of e.entries()){if("XMR"===t&&a.length>1)throw new p.Z("NO_SOLUTION",{extra:"MULTIPLE_TRADES_IN_MONERO_UTXO_GROUP",asset:t});(0,s.d4)(a,"value"),(0,s.d4)(r,"value");let e={assignedUtxos:r.map(t=>{let{id:e}=t;return{id:e}}),assignedTrades:a.map(t=>{let{id:e}=t;return{id:e,txTree:{}}})};n.push(e)}},I=async function(t,e,n,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},i=await C("minTrades",[n,e],a);S(t,i,r)},_=async(t,e,n,r,a)=>{try{let i=await C("minOverpay",[n,e],a);if(!i)throw new p.Z("NO_SOLUTION");S(t,i,r)}catch(t){throw console.error("useMinOverpaySolver error",t),t}},C=async function(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise((a,i)=>{let s;if(!e[0].length||!e[1].length)throw new p.Z("INVALID_SOLVER_INPUT");switch(t){case"minTrades":s=new Worker(n.tu(new URL(n.p+n.u(490620),n.b)));break;case"minOverpay":s=new Worker(n.tu(new URL(n.p+n.u(125389),n.b)))}s.onmessage=t=>{let e=t.data;"START"===e?setTimeout(()=>{try{s.terminate(),i("SOLVER_TIMEOUT")}catch(t){i("SOLVER_TIMEOUT")}},u.rh):(a(e),s.terminate())},s.onerror=t=>{s.terminate(),i(t)},r.onabort=()=>{s.terminate(),i(new p.Z("ABORTED"))},s.postMessage(e)})},R=(t,e,n,r)=>{for(let{value:t,id:a}of e){let e=new o.Z(t),i={assignedUtxos:[],assignedTrades:[{id:a,txTree:{}}]};for(;e.gt(0);){if(0===n.length)throw Error("Best fit couldn't satisfy the trade.");for(let t=0;t<n.length;t++){let{value:r,id:a}=n[t],s=()=>{e=e.minus(r),i.assignedUtxos.push({id:a}),n.splice(t,1)};if(t!==n.length-1){if(e.lte(r)){s();break}}else s()}}r.push(i)}},x=t=>{let{amountAsset:e,feeAsset:n,ad:{type:r}}=t;return r.includes("SELL")?e:new o.Z(e).minus(n).toString()},N=async(t,e,n)=>{let r=[],a=0,i=e.internalWalletChainLastUsedAddressIndex;for(let{assignedTrades:s}of t){(0,v.s)(n);let t=[];for(let n=0;n<s.length;n++){let n=await e.deriveReceive(i+1+a,1);t.push(n),a++}r.push(t)}return r},U=async function(t,e,n,r,a,i,u){let f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:{},{assignedUtxos:d,assignedTrades:w}=n,h=async n=>{try{(0,v.s)(f),n.txTree||(n.txTree={});let h=(0,m.RL)(t),p=h.filter(t=>d.some(e=>{let{id:n}=e;return n===(0,y.Wp)(t)})),g=(0,m.RL)(e),T=g.find(t=>{let{id:e}=t;return e===n.id}),{buyerSettlementAddress:b,buyerSettlementFeeLevel:E,platformFeeAddress:O,feeAsset:A,id:S}=T,I=[{address:b,value:(0,s.NF)(x(T),"BTC")},{address:O,value:(0,s.NF)(A,"BTC")}],_=[];if(w.length>1){n.txTree.childRawTxs=[];let t=(0,m.RL)(w);(_=t.filter(t=>t.id!==S).map(t=>{let{id:e}=t;return g.find(t=>t.id===e)})).forEach((t,e)=>{let n=u[e+1];t.parentUtxoAddress=n,I.push({isChange:!0,address:n,value:(0,s.NF)(new o.Z(x(t)).plus(t.feeAsset),"BTC")})})}let{inputs:C,outputs:R}=(0,c.zc)(p,I,i[E],0,1,"split");(0,v.s)(f);let{psbt:N,tx:U}=await (0,l.oI)(C,R,a,r,u[0]);if(n.txTree.rawTx=N.toBase64(),_.length){n.txTree.childRawTxs=[];let t=await (0,c.vM)(U);for(let e of _){let{buyerSettlementAddress:o,buyerSettlementFeeLevel:u,platformFeeAddress:d,feeAsset:w,id:h,parentUtxoAddress:p}=e,g=t.find(t=>{let{address:e}=t;return e===p}),y=[{address:o,value:(0,s.NF)(x(e),"BTC")},{address:d,value:(0,s.NF)(w,"BTC")}];try{let{inputs:t,outputs:e}=(0,c.zc)([g],y,i[u],0,1);(0,v.s)(f);let{psbt:s,tx:o}=await (0,l.oI)(t,e,a,r);n.txTree.childRawTxs.push({id:h,rawTx:s.toBase64()})}catch(t){throw t}}}}catch(t){if("OUTPUT_BELOW_DUST_THRESHOLD"===t)throw new p.Z("OUTPUT_BELOW_DUST_THRESHOLD",{tradeId:n.id});throw t}};for(let t of w)await h(t)},B=async function(t,e,n,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},{buyerSettlementAddress:i,platformFeeAddress:s,feeAsset:o,id:u}=e,c=await r.arrayOfOutputsToKeyImages(t),l=c.filter(t=>!n.assignedUtxos.some(e=>e.id===t)),f=l.map(t=>r.freezeOutput(t));await Promise.all(f);let d=[{address:i,amount:x(e)},{address:s,amount:o}];try{(0,v.s)(a);let{partiallySignedMultisigTxHex:t}=await r.buildTx(d);n.assignedTrades[0].txTree.rawTx=t}catch(t){throw console.error("Error building a tx for trade ".concat(u),t),t}finally{let t=l.map(t=>r.thawOutput(t));await Promise.all(t)}};class P{assignTrade(t){this.trades.push(t)}get remainingUtxosValue(){let t=(0,s.d4)(this.utxos,"value"),e=(0,s.d4)(this.trades,"value");return t-e}get numberOfAssignedTrades(){return this.trades.length}constructor(t,e){this.utxos=t,this.trades=null!=e?e:[]}}let L=t=>{let e=[],n=[];return t.forEach(t=>{e.push(...t.utxos),n.push(...t.trades)}),new P(M(e),M(n))},M=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"id";return t.filter((t,n,r)=>n===r.findIndex(n=>n[e]===t[e]))},D=(t,e,n,r)=>{let a=(0,s.IK)(t,"value","desc"),i=(0,s.IK)(e,"value","desc"),o=k(e.length+1);o[0]=a.map(t=>new P([t]));let u=()=>{o.forEach(t=>{t.sort((t,e)=>e.remainingUtxosValue-t.remainingUtxosValue)})};for(let t of i){let{value:e}=t,n=0,a=[];for(let i of o){if(n>=e)break;for(let[s,o]of i.entries())if(("XMR"!==r||!o.numberOfAssignedTrades)&&(n+=o.remainingUtxosValue,o.assignTrade(t),a.push(o),i.splice(s,1),n>=e))break}if(n<e)throw new p.Z("NO_SOLUTION",{availableUtxos:o,trade:t,asset:r});let i=L(a);o[i.numberOfAssignedTrades].push(i),u()}o.forEach(t=>{t.forEach(t=>{t.numberOfAssignedTrades&&n.push({assignedUtxos:t.utxos.map(t=>{let{id:e}=t;return{id:e}}),assignedTrades:t.trades.map(t=>{let{id:e}=t;return{id:e,txTree:{}}})})})})},k=t=>{let e=Array(t);for(let n=0;n<t;n++)e[n]=[];return e},W={SYNC:"Syncing wallet",SOLUTION:"Assigning utxos",TX:"Building txs",SUBMIT:"Submitting"},H=t=>{let e=Object.keys(W);return{currentStep:e.indexOf(t)+1,totalSteps:e.length}}},690261:function(t,e,n){"use strict";n.d(e,{h:function(){return r}});let r=()=>self!==self.window},69159:function(){},269386:function(){},931616:function(){},200199:function(){}}]);